var express = require('express')var router = express.Router()var WebTag = require('../../models/tag/tag')var bodyParser = require('body-parser')const path = require('path');const multer = require('multer');// const upload = multer({dest:'./public/images/tagImg/'});var storage = multer.diskStorage({    destination: function (req, file, cb) {        cb(null, './public/images/tagImg/')    },    filename: function (req, file, cb) {        // var singfileArray = file.originalname.split('.');        // var fileExtension = singfileArray[singfileArray.length - 1];        cb(null, req.body.name + "." + 'png')    }})var upload = multer({ storage: storage })var app = express();app.use(bodyParser.json());app.use(bodyParser.urlencoded({ extended: false}));// 添加标签router.post('/cms/addTag/',upload.single('files'),(req,res)=>{    console.log('bodyaa',req.file)    console.log(req.body)    var tag={        tagName:req.body.tagName,        tagUrl:req.body.tagUrl,        tagStarsNum:req.body.tagStarsNum,        tagArticlesNum:req.body.tagArticlesNum,        ifStar:req.body.ifStar,    }    WebTag.findOne({        tagName:tag.tagName    },(err,data)=>{        if(err) throw err;        if(data){            res.send({status:'repeat'})        }else{            WebTag.create(tag,(err,data)=>{                if(err){                    throw err                }                res.send({status:'success'})// res.redirect('/userList')})        }    })})router.get('/cms/getTag/',(req,res)=>{    var tagList = WebTag.find({},(err,data)=>{        if(err) throw err;        res.send(data)    })})// 获取已关注的标签router.get('/main/getFollowTags/',(req,res)=>{    var userList = WebTag.find({        ifStar:true    },(err,data)=>{        if(err) throw err;        res.send(data)    })})router.post('/main/register/',(req,res)=>{    console.log(req.body)    var postData = {        userName:req.body.userName,        passWord:req.body.passWord,    }// 查询是否注册WebTag.findOne({userName:postData.userName},(err,data)=>{    if(data){        res.send({status:'repeat'})    }else{        WebTag.create(postData,(err,data)=>{            if(err){                throw err            }            res.send({status:'success'})// res.redirect('/userList')})    }})})// 获取用户列表router.get('/userList',(req,res)=>{    var userList = WebTag.find({},(err,data)=>{        if(err) throw err;        res.send(data)    })})module.exports = router